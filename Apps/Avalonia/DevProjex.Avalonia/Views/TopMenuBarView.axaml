<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:DevProjex.Avalonia.ViewModels"
             xmlns:views="using:DevProjex.Avalonia.Views"
             x:Class="DevProjex.Avalonia.Views.TopMenuBarView"
             x:DataType="vm:MainWindowViewModel">
  <Grid Name="RootGrid" ColumnDefinitions="*,Auto,Auto" Margin="0">
    <!-- Keep menu surface spanning all columns to avoid transparency seams near the controls. -->
    <Menu Name="MainMenu" Grid.Column="0" Grid.ColumnSpan="3" Margin="0">
      <MenuItem Header="{Binding MenuFile}">
        <MenuItem Header="{Binding MenuFileOpen}" Click="OnOpenFolder" />
        <MenuItem Header="{Binding MenuFileRefresh}" Click="OnRefresh" IsEnabled="{Binding IsProjectLoaded}" />
        <MenuItem Header="{Binding MenuFileExit}" Click="OnExit" />
      </MenuItem>
      <MenuItem Name="GitMenuItem" Header="Git">
        <MenuItem Header="{Binding MenuGitClone}" Click="OnGitClone" />
        <MenuItem Name="GitBranchMenuItem" Header="{Binding MenuGitBranch}" IsEnabled="{Binding IsGitMode}">
          <!-- Branch items will be populated dynamically -->
        </MenuItem>
        <MenuItem Header="{Binding MenuGitGetUpdates}" Click="OnGitGetUpdates" IsEnabled="{Binding IsGitMode}" />
      </MenuItem>
      <MenuItem Header="{Binding MenuCopy}" IsEnabled="{Binding IsProjectLoaded}">
        <MenuItem Header="{Binding MenuCopyTree}" Click="OnCopyTree" />
        <MenuItem Header="{Binding MenuCopyContent}" Click="OnCopyContent" />
        <MenuItem Header="{Binding MenuCopyTreeAndContent}" Click="OnCopyTreeAndContent" />
      </MenuItem>
      <MenuItem Header="{Binding MenuView}" IsEnabled="{Binding IsProjectLoaded}">
        <MenuItem Header="{Binding MenuViewExpandAll}" Click="OnExpandAll" />
        <MenuItem Header="{Binding MenuViewCollapseAll}" Click="OnCollapseAll" />
        <MenuItem Header="{Binding MenuViewZoomIn}" Click="OnZoomIn" />
        <MenuItem Header="{Binding MenuViewZoomOut}" Click="OnZoomOut" />
        <MenuItem Header="{Binding MenuViewZoomReset}" Click="OnZoomReset" />
        <Separator />
        <MenuItem Click="OnToggleCompactMode">
          <MenuItem.Header>
            <CheckBox Content="{Binding MenuViewCompactMode}"
                      IsChecked="{Binding IsCompactMode}"
                      IsHitTestVisible="False"/>
          </MenuItem.Header>
        </MenuItem>
      </MenuItem>
      <MenuItem Header="{Binding MenuSearch}" IsEnabled="{Binding IsProjectLoaded}" Click="OnToggleSearch" />
      <MenuItem Header="{Binding MenuOptions}" IsEnabled="{Binding IsProjectLoaded}" Click="OnToggleSettings" />
      <MenuItem Header="{Binding MenuLanguage}">
        <MenuItem Header="Русский" Click="OnLangRu" />
        <MenuItem Header="English" Click="OnLangEn" />
        <MenuItem Header="Oʻzbek" Click="OnLangUz" />
        <MenuItem Header="Тоҷикӣ" Click="OnLangTg" />
        <MenuItem Header="Қазақ" Click="OnLangKk" />
        <MenuItem Header="Français" Click="OnLangFr" />
        <MenuItem Header="Deutsch" Click="OnLangDe" />
        <MenuItem Header="Italiano" Click="OnLangIt" />
      </MenuItem>
      <MenuItem Name="ThemeMenuItem" Header="{Binding MenuTheme}" Click="OnThemeMenuClick" />
      <MenuItem Name="HelpMenuItem" Header="{Binding MenuHelp}">
        <MenuItem Header="{Binding MenuHelpHelp}" Click="OnHelp" />
        <MenuItem Header="{Binding MenuHelpAbout}" Click="OnAbout" />
        <Separator />
        <MenuItem Header="{Binding MenuHelpResetSettings}" Click="OnResetSettings" />
      </MenuItem>
    </Menu>

    <!-- Format Switcher: Segmented Control (ASCII/JSON) with sliding thumb -->
    <Border Grid.Column="1"
            Classes="segmented-control"
            IsEnabled="{Binding IsProjectLoaded}"
            IsVisible="{Binding IsProjectLoaded}"
            Margin="0,0,4,0"
            ToolTip.Tip="{Binding CopyFormatTooltip}"
            ToolTip.ShowDelay="700">
      <Panel>
        <!-- Sliding thumb indicator - single element that moves -->
        <Border Name="SegmentThumb"
                Classes="segment-thumb"
                Width="48"
                HorizontalAlignment="Left"
                VerticalAlignment="Stretch"
                Classes.segment-thumb-right="{Binding IsJsonFormatSelected}" />

        <!-- Buttons container -->
        <StackPanel Orientation="Horizontal">
          <!-- ASCII button -->
          <Button Classes="segment-text-button"
                  Classes.segment-selected="{Binding IsAsciiFormatSelected}"
                  Content="ASCII"
                  Click="OnAsciiFormatClick" />

          <!-- JSON button -->
          <Button Classes="segment-text-button"
                  Classes.segment-selected="{Binding IsJsonFormatSelected}"
                  Content="JSON"
                  Click="OnJsonFormatClick" />
        </StackPanel>
      </Panel>
    </Border>

    <Button Grid.Column="2"
            Classes="menu-icon-button"
            Click="OnToggleFilter"
            IsEnabled="{Binding IsProjectLoaded}"
            IsVisible="{Binding IsProjectLoaded}"
            ToolTip.Tip="{Binding FilterTooltip}"
            ToolTip.Placement="Left">
      <Image Source="avares://DevProjex.Avalonia/IconPacks/Default/UIFilter.png"
             Width="24"
             Height="24"
             Stretch="Uniform" />
    </Button>

    <!-- Theme Popover -->
    <Popup Name="ThemePopup"
           IsOpen="{Binding ThemePopoverOpen, Mode=TwoWay}"
           IsLightDismissEnabled="True"
           PlacementMode="Bottom"
           PlacementTarget="{Binding #ThemeMenuItem}">
      <views:ThemePopoverView Name="ThemePopover" />
    </Popup>

    <!-- Help Popover -->
    <Popup Name="HelpPopup"
           IsOpen="{Binding HelpPopoverOpen, Mode=TwoWay}"
           IsLightDismissEnabled="True"
           PlacementConstraintAdjustment="All"
           PlacementMode="Bottom"
           PlacementTarget="{Binding #HelpMenuItem}">
      <views:AboutPopoverView Name="HelpPopover" />
    </Popup>

    <!-- Help Docs Popover -->
    <Popup Name="HelpDocsPopup"
           IsOpen="{Binding HelpDocsPopoverOpen, Mode=TwoWay}"
           IsLightDismissEnabled="True"
           PlacementConstraintAdjustment="All"
           PlacementMode="Bottom"
           PlacementTarget="{Binding #HelpMenuItem}">
      <views:HelpPopoverView Name="HelpDocsPopover" />
    </Popup>

  </Grid>
</UserControl>
